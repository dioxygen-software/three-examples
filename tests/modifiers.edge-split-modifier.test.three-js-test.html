<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - modifier - Edge Split modifier</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        .lil-gui {
            --background-color: #1f1f1f;
            --text-color: #ebebeb;
            --title-background-color: #111;
            --title-text-color: #ebebeb;
            --widget-color: #424242;
            --hover-color: #4f4f4f;
            --focus-color: #595959;
            --number-color: #2cc9ff;
            --string-color: #a2db3c;
            --font-size: 11px;
            --input-font-size: 11px;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
            --padding: 4px;
            --spacing: 4px;
            --widget-height: 20px;
            --name-width: 45%;
            --slider-knob-width: 2px;
            --slider-input-width: 27%;
            --color-input-width: 27%;
            --slider-input-min-width: 45px;
            --color-input-min-width: 45px;
            --folder-indent: 7px;
            --widget-padding: 0 0 0 3px;
            --widget-border-radius: 2px;
            --checkbox-size: calc(var(--widget-height)*0.75);
            --scrollbar-width: 5px;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: var(--font-size);
            font-style: normal;
            font-weight: 400;
            line-height: 1;
            text-align: left;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none
        }

        .lil-gui,
        .lil-gui * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        .lil-gui.root {
            display: flex;
            flex-direction: column;
            width: var(--width, 245px)
        }

        .lil-gui.root>.title {
            background: var(--title-background-color);
            color: var(--title-text-color)
        }

        .lil-gui.root>.children {
            overflow-x: hidden;
            overflow-y: auto
        }

        .lil-gui.root>.children::-webkit-scrollbar {
            background: var(--background-color);
            height: var(--scrollbar-width);
            width: var(--scrollbar-width)
        }

        .lil-gui.root>.children::-webkit-scrollbar-thumb {
            background: var(--focus-color);
            border-radius: var(--scrollbar-width)
        }

        .lil-gui.force-touch-styles {
            --widget-height: 28px;
            --padding: 6px;
            --spacing: 6px;
            --font-size: 13px;
            --input-font-size: 16px;
            --folder-indent: 10px;
            --scrollbar-width: 7px;
            --slider-input-min-width: 50px;
            --color-input-min-width: 65px
        }

        .lil-gui.autoPlace {
            max-height: 100%;
            position: fixed;
            right: 15px;
            top: 0;
            z-index: 1001
        }

        .lil-gui .controller {
            align-items: center;
            display: flex;
            margin: var(--spacing) 0;
            padding: 0 var(--padding)
        }

        .lil-gui .controller.disabled {
            opacity: .5
        }

        .lil-gui .controller.disabled,
        .lil-gui .controller.disabled * {
            pointer-events: none !important
        }

        .lil-gui .controller>.name {
            flex-shrink: 0;
            line-height: var(--widget-height);
            min-width: var(--name-width);
            padding-right: var(--spacing);
            white-space: pre
        }

        .lil-gui .controller .widget {
            align-items: center;
            display: flex;
            min-height: var(--widget-height);
            position: relative;
            width: 100%
        }

        .lil-gui .controller.string input {
            color: var(--string-color)
        }

        .lil-gui .controller.boolean .widget {
            cursor: pointer
        }

        .lil-gui .controller.color .display {
            border-radius: var(--widget-border-radius);
            height: var(--widget-height);
            position: relative;
            width: 100%
        }

        .lil-gui .controller.color input[type=color] {
            cursor: pointer;
            height: 100%;
            opacity: 0;
            width: 100%
        }

        .lil-gui .controller.color input[type=text] {
            flex-shrink: 0;
            font-family: var(--font-family-mono);
            margin-left: var(--spacing);
            min-width: var(--color-input-min-width);
            width: var(--color-input-width)
        }

        .lil-gui .controller.option select {
            max-width: 100%;
            opacity: 0;
            position: absolute;
            width: 100%
        }

        .lil-gui .controller.option .display {
            background: var(--widget-color);
            border-radius: var(--widget-border-radius);
            height: var(--widget-height);
            line-height: var(--widget-height);
            max-width: 100%;
            overflow: hidden;
            padding-left: .55em;
            padding-right: 1.75em;
            pointer-events: none;
            position: relative;
            word-break: break-all
        }

        .lil-gui .controller.option .display.active {
            background: var(--focus-color)
        }

        .lil-gui .controller.option .display:after {
            bottom: 0;
            content: "↕";
            font-family: lil-gui;
            padding-right: .375em;
            position: absolute;
            right: 0;
            top: 0
        }

        .lil-gui .controller.option .widget,
        .lil-gui .controller.option select {
            cursor: pointer
        }

        .lil-gui .controller.number input {
            color: var(--number-color)
        }

        .lil-gui .controller.number.hasSlider input {
            flex-shrink: 0;
            margin-left: var(--spacing);
            min-width: var(--slider-input-min-width);
            width: var(--slider-input-width)
        }

        .lil-gui .controller.number .slider {
            background-color: var(--widget-color);
            border-radius: var(--widget-border-radius);
            cursor: ew-resize;
            height: var(--widget-height);
            overflow: hidden;
            padding-right: var(--slider-knob-width);
            touch-action: pan-y;
            width: 100%
        }

        .lil-gui .controller.number .slider.active {
            background-color: var(--focus-color)
        }

        .lil-gui .controller.number .slider.active .fill {
            opacity: .95
        }

        .lil-gui .controller.number .fill {
            border-right: var(--slider-knob-width) solid var(--number-color);
            box-sizing: content-box;
            height: 100%
        }

        .lil-gui-dragging .lil-gui {
            --hover-color: var(--widget-color)
        }

        .lil-gui-dragging * {
            cursor: ew-resize !important
        }

        .lil-gui-dragging.lil-gui-vertical * {
            cursor: ns-resize !important
        }

        .lil-gui .title {
            --title-height: calc(var(--widget-height) + var(--spacing)*1.25);
            -webkit-tap-highlight-color: transparent;
            text-decoration-skip: objects;
            cursor: pointer;
            font-weight: 600;
            height: var(--title-height);
            line-height: calc(var(--title-height) - 4px);
            outline: none;
            padding: 0 var(--padding)
        }

        .lil-gui .title:before {
            content: "▾";
            display: inline-block;
            font-family: lil-gui;
            padding-right: 2px
        }

        .lil-gui .title:active {
            background: var(--title-background-color);
            opacity: .75
        }

        .lil-gui.root>.title:focus {
            text-decoration: none !important
        }

        .lil-gui.closed>.title:before {
            content: "▸"
        }

        .lil-gui.closed>.children {
            opacity: 0;
            transform: translateY(-7px)
        }

        .lil-gui.closed:not(.transition)>.children {
            display: none
        }

        .lil-gui.transition>.children {
            overflow: hidden;
            pointer-events: none;
            transition-duration: .3s;
            transition-property: height, opacity, transform;
            transition-timing-function: cubic-bezier(.2, .6, .35, 1)
        }

        .lil-gui .children:empty:before {
            content: "Empty";
            display: block;
            font-style: italic;
            height: var(--widget-height);
            line-height: var(--widget-height);
            margin: var(--spacing) 0;
            opacity: .5;
            padding: 0 var(--padding)
        }

        .lil-gui.root>.children>.lil-gui>.title {
            border-width: 0;
            border-bottom: 1px solid var(--widget-color);
            border-left: 0 solid var(--widget-color);
            border-right: 0 solid var(--widget-color);
            border-top: 1px solid var(--widget-color);
            transition: border-color .3s
        }

        .lil-gui.root>.children>.lil-gui.closed>.title {
            border-bottom-color: transparent
        }

        .lil-gui+.controller {
            border-top: 1px solid var(--widget-color);
            margin-top: 0;
            padding-top: var(--spacing)
        }

        .lil-gui .lil-gui .lil-gui>.title {
            border: none
        }

        .lil-gui .lil-gui .lil-gui>.children {
            border: none;
            border-left: 2px solid var(--widget-color);
            margin-left: var(--folder-indent)
        }

        .lil-gui .lil-gui .controller {
            border: none
        }

        .lil-gui input {
            -webkit-tap-highlight-color: transparent;
            background: var(--widget-color);
            border: 0;
            border-radius: var(--widget-border-radius);
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: var(--input-font-size);
            height: var(--widget-height);
            outline: none;
            width: 100%
        }

        .lil-gui input:disabled {
            opacity: 1
        }

        .lil-gui input[type=number],
        .lil-gui input[type=text] {
            padding: var(--widget-padding)
        }

        .lil-gui input[type=number]:focus,
        .lil-gui input[type=text]:focus {
            background: var(--focus-color)
        }

        .lil-gui input::-webkit-inner-spin-button,
        .lil-gui input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0
        }

        .lil-gui input[type=number] {
            -moz-appearance: textfield
        }

        .lil-gui input[type=checkbox] {
            appearance: none;
            -webkit-appearance: none;
            border-radius: var(--widget-border-radius);
            cursor: pointer;
            height: var(--checkbox-size);
            text-align: center;
            width: var(--checkbox-size)
        }

        .lil-gui input[type=checkbox]:checked:before {
            content: "✓";
            font-family: lil-gui;
            font-size: var(--checkbox-size);
            line-height: var(--checkbox-size)
        }

        .lil-gui button {
            -webkit-tap-highlight-color: transparent;
            background: var(--widget-color);
            border: 1px solid var(--widget-color);
            border-radius: var(--widget-border-radius);
            color: var(--text-color);
            cursor: pointer;
            font-family: var(--font-family);
            font-size: var(--font-size);
            height: var(--widget-height);
            line-height: calc(var(--widget-height) - 4px);
            outline: none;
            text-align: center;
            text-transform: none;
            width: 100%
        }

        .lil-gui button:active {
            background: var(--focus-color)
        }

        @font-face {
            font-family: lil-gui;
            src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")
        }

        @media (pointer:coarse) {
            .lil-gui.allow-touch-styles {
                --widget-height: 28px;
                --padding: 6px;
                --spacing: 6px;
                --font-size: 13px;
                --input-font-size: 16px;
                --folder-indent: 10px;
                --scrollbar-width: 7px;
                --slider-input-min-width: 50px;
                --color-input-min-width: 65px
            }
        }

        @media (hover:hover) {
            .lil-gui .controller.color .display:hover:before {
                border: 1px solid #fff9;
                border-radius: var(--widget-border-radius);
                bottom: 0;
                content: " ";
                display: block;
                left: 0;
                position: absolute;
                right: 0;
                top: 0
            }

            .lil-gui .controller.option .display.focus {
                background: var(--focus-color)
            }

            .lil-gui .controller.option .widget:hover .display {
                background: var(--hover-color)
            }

            .lil-gui .controller.number .slider:hover {
                background-color: var(--hover-color)
            }

            body:not(.lil-gui-dragging) .lil-gui .title:hover {
                background: var(--title-background-color);
                opacity: .85
            }

            .lil-gui .title:focus {
                text-decoration: underline var(--focus-color)
            }

            .lil-gui input:hover {
                background: var(--hover-color)
            }

            .lil-gui input:active {
                background: var(--focus-color)
            }

            .lil-gui input[type=checkbox]:focus {
                box-shadow: inset 0 0 0 1px var(--focus-color)
            }

            .lil-gui button:hover {
                background: var(--hover-color);
                border-color: var(--hover-color)
            }

            .lil-gui button:focus {
                border-color: var(--focus-color)
            }
        }
    </style>
</head>

<body class="">
    <script type="importmap">
        {
            "imports": {
                "three": "../node_modules/three/build/three.module.js",
                "three/" : "../node_modules/three/",
                "@dioxygen-software/three-js-extra-public": "../dist/three-js-extra-public.module.js",
                "three/examples/jsm/utils/BufferGeometryUtils.js": "../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js",
                "dat.gui": "../node_modules/dat.gui/build/dat.gui.module.js"
            }
        }
    </script>

    <script type="module">

        import * as THREE from 'three';

        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';
        import { OBJLoader } from 'three/examples/jsm/loaders/OBJLoader.js';
        import { EdgeSplitModifier } from '@dioxygen-software/three-js-extra-public';
        import { BufferGeometryUtils } from '../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js';

        import { GUI } from 'dat.gui';

        let renderer, scene, camera;
        let modifier, mesh, baseGeometry;
        let map;

        const params = {
            smoothShading: true,
            edgeSplit: true,
            cutOffAngle: 20,
            showMap: false,
            tryKeepNormals: true,
        };

        init();

        function init() {

            const info = document.createElement('div');
            info.style.position = 'absolute';
            info.style.top = '10px';
            info.style.width = '100%';
            info.style.textAlign = 'center';
            info.innerHTML = '<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - Edge Split modifier';
            document.body.appendChild(info);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.addEventListener('change', render); // use if there is no animation loop
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.rotateSpeed = 0.35;
            controls.minZoom = 1;
            camera.position.set(0, 0, 4);

            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 3));

            new OBJLoader().load(
                './models/Cerberus.obj',
                function (group) {

                    const cerberus = group.children[0];
                    const modelGeometry = cerberus.geometry;

                    modifier = new EdgeSplitModifier();
                    baseGeometry = BufferGeometryUtils.mergeVertices(modelGeometry);

                    mesh = new THREE.Mesh(getGeometry(), new THREE.MeshStandardMaterial());
                    mesh.material.flatShading = !params.smoothShading;
                    mesh.rotateY(- Math.PI / 2);
                    mesh.scale.set(3.5, 3.5, 3.5);
                    mesh.translateZ(1.5);
                    scene.add(mesh);

                    if (map !== undefined && params.showMap) {

                        mesh.material.map = map;
                        mesh.material.needsUpdate = true;

                    }

                    render();

                }
            );

            window.addEventListener('resize', onWindowResize);

            new THREE.TextureLoader().load('./models/Cerberus_A.jpg', function (texture) {

                map = texture;
                map.colorSpace = THREE.SRGBColorSpace;

                if (mesh !== undefined && params.showMap) {

                    mesh.material.map = map;
                    mesh.material.needsUpdate = true;

                }

            });


            const gui = new GUI({ title: 'Edge split modifier parameters' });

            gui.add(params, 'showMap').onFinishChange(updateMesh);
            gui.add(params, 'smoothShading').onFinishChange(updateMesh);
            gui.add(params, 'edgeSplit').onFinishChange(updateMesh);
            gui.add(params, 'cutOffAngle').min(0).max(180).onFinishChange(updateMesh);
            gui.add(params, 'tryKeepNormals').onFinishChange(updateMesh);

        }

        function onWindowResize() {

            renderer.setSize(window.innerWidth, window.innerHeight);

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            render();

        }


        function getGeometry() {

            let geometry;

            if (params.edgeSplit) {

                geometry = modifier.modify(
                    baseGeometry,
                    params.cutOffAngle * Math.PI / 180,
                    params.tryKeepNormals
                );

            } else {

                geometry = baseGeometry;

            }

            return geometry;

        }


        function updateMesh() {

            if (mesh !== undefined) {

                mesh.geometry = getGeometry();

                let needsUpdate = mesh.material.flatShading === params.smoothShading;
                mesh.material.flatShading = params.smoothShading === false;

                if (map !== undefined) {

                    needsUpdate = needsUpdate || mesh.material.map !== (params.showMap ? map : null);
                    mesh.material.map = params.showMap ? map : null;

                }

                mesh.material.needsUpdate = needsUpdate;

                render();

            }

        }


        function render() {

            renderer.render(scene, camera);

        }

    </script>



    <div style="position: absolute; top: 10px; width: 100%; text-align: center;"><a href="https://threejs.org"
            target="_blank" rel="noopener">three.js</a> - Edge Split modifier</div><canvas
        style="display: block; width: 1850px; height: 572px; touch-action: none;" data-engine="three.js r165"
        width="3700" height="1144"></canvas>
    <div class="lil-gui allow-touch-styles root autoPlace">
        <div class="title" role="button" aria-expanded="true" tabindex="0">Edge split modifier parameters</div>
        <div class="children">
            <div class="controller boolean">
                <div class="name" id="lil-gui-name-1">showMap</div><label class="widget"><input type="checkbox"
                        aria-labelledby="lil-gui-name-1"></label>
            </div>
            <div class="controller boolean">
                <div class="name" id="lil-gui-name-2">smoothShading</div><label class="widget"><input type="checkbox"
                        aria-labelledby="lil-gui-name-2"></label>
            </div>
            <div class="controller boolean">
                <div class="name" id="lil-gui-name-3">edgeSplit</div><label class="widget"><input type="checkbox"
                        aria-labelledby="lil-gui-name-3"></label>
            </div>
            <div class="controller number hasSlider">
                <div class="name" id="lil-gui-name-4">cutOffAngle</div>
                <div class="widget">
                    <div class="slider">
                        <div class="fill" style="width: 100%;"></div>
                    </div><input type="number" step="any" aria-labelledby="lil-gui-name-4">
                </div>
            </div>
            <div class="controller boolean">
                <div class="name" id="lil-gui-name-5">tryKeepNormals</div><label class="widget"><input type="checkbox"
                        aria-labelledby="lil-gui-name-5"></label>
            </div>
        </div>
    </div>
</body>

</html>